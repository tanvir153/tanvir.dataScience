<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Reviews | Tanvir DS</title>
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
    rel="stylesheet"/>
  <style>
    body { font-family:'Segoe UI',sans-serif; background:#f8f9fa; }
    .review-card {
      background:#fff;
      padding:1rem;
      border-radius:.5rem;
      box-shadow:0 0 8px rgba(0,0,0,.05);
    }
    .field-label { font-weight:600; }
    .star { color:#ffc107; margin-right:4px; }
    .star.text-muted { color:#ddd; }
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="index.html">Tanvir DS</a>
      <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navmenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navmenu">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link active" href="review.html">Reviews</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <header class="bg-primary text-white text-center py-5 mb-4">
    <h1>🌟 Student Reviews</h1>
    <p class="lead">Leave your feedback below—and see what others have said!</p>
  </header>

  <div class="container">

    <!-- 1) Your embedded Google Form -->
    <div class="mb-5">
      <iframe
        src="https://docs.google.com/forms/d/e/1FAIpQLScttItEWGreC6BoWzmMonpt0zd1XwIGhxXAZQ_J18LXDSR3tA/viewform?embedded=true"
        width="100%" height="1000" frameborder="0" marginheight="0" marginwidth="0">
        Loading…
      </iframe>
    </div>

    <!-- 2) Dashboard of all responses -->
    <h2 class="mb-4">What People Are Saying</h2>
    <div id="reviewsList" class="row g-4 mb-5">
      <!-- JS will inject .review-card columns here -->
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    //  • your published‐CSV URL (entire sheet as CSV)
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRuUC8sCOJdvwZemHRQxs0kuaZFaxsmrIcigiYflbOgqmEW14tuILwgS3QDx7tXnheyyu8q4yTNitjV/pub?output=csv';

    //  simple CSV → JSON
    function parseCSV(text) {
      const lines   = text.trim().split('\n');
      const headers = lines.shift().split(',').map(h=>h.replace(/^"|"$/g,''));
      return lines.map(line => {
        const cols = (line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || []);
        const obj  = {};
        headers.forEach((h,i)=> obj[h] = (cols[i]||'').replace(/^"|"$/g,''));
        return obj;
      });
    }

    //  ★★★☆☆ string
    function starString(n) {
      n = +n;
      return '<span class="star">' + '★'.repeat(n) + '</span>'
           + '<span class="star text-muted">' + '★'.repeat(5-n) + '</span>';
    }

    //  fetch + render
    async function loadReviews() {
      try {
        const res  = await fetch(CSV_URL);
        const text = await res.text();
        const rows = parseCSV(text);
        const container = document.getElementById('reviewsList');

        container.innerHTML = rows.reverse().map(row => {
          // build a <p> for each column
          const fields = Object.entries(row).map(([key,val]) => {
            if (/rating/i.test(key)) {
              return `<p><span class="field-label">${key}:</span> ${starString(val)}</p>`;
            }
            return `<p><span class="field-label">${key}:</span> ${val}</p>`;
          }).join('');

          return `
            <div class="col-md-4">
              <div class="review-card">
                ${fields}
              </div>
            </div>
          `;
        }).join('');

      } catch(e) {
        console.error('Could not load reviews:', e);
      }
    }

    window.addEventListener('DOMContentLoaded', loadReviews);
  </script>
</body>
</html>
